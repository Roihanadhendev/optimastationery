// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id       String    @id @default(cuid())
  name     String
  slug     String    @unique
  products Product[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

model Product {
  id          String  @id @default(cuid())
  categoryId  String  @map("category_id")
  name        String
  slug        String  @unique
  sku         String  @unique
  description String? @db.Text

  price       Decimal  @db.Decimal(12, 2)
  stockStatus Boolean  @default(true) @map("stock_status")
  imageUrl    String?  @map("image_url") @db.Text
  isFeatured  Boolean  @default(false) @map("is_featured")

  category  Category   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  priceLogs PriceLog[]
  inquiries Inquiry[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([categoryId])
  @@index([isFeatured])
  @@map("products")
}

model PriceLog {
  id        String  @id @default(cuid())
  productId String  @map("product_id")
  oldPrice  Decimal @map("old_price") @db.Decimal(12, 2)
  newPrice  Decimal @map("new_price") @db.Decimal(12, 2)
  changedBy String  @default("ADMIN") @map("changed_by")
  reason    String? @db.Text

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@index([productId])
  @@map("price_logs")
}

model Inquiry {
  id          String  @id @default(cuid())
  productId   String? @map("product_id")
  productName String  @map("product_name")
  customerPhone String? @map("customer_phone")
  source      String  @default("whatsapp")

  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now()) @map("created_at")

  @@index([productId])
  @@index([createdAt])
  @@map("inquiries")
}
